<layout name='Layout/wbs_home' />
<script type="text/javascript">
    function zTreeOnClick(event, treeId, treeNode) {
        var wt = treeNode.wbs_type;
        //alert("wbs_type="+wt);
    };

    function setFontCss(treeId, treeNode) {
        return treeNode.node_type == "pbs" ? {color:"Gray"} : {color: "Black"};
    };

    // 控制节点图标是否显示
    function showIconForTree(treeId, treeNode) {
        return treeNode.node_type == "wbs";
    };

    var setting = {
        callback: {onClick: zTreeOnClick},
        view: {
            //fontCss: setFontCss
            showIcon: showIconForTree
            //nameIsHTML: true
        }
    };

    var nodes = {$node_json|default="[空节点]"};
    $(document).ready(function(){
        $.fn.zTree.init($("#wbs_tree"), setting, nodes);
    });

</script>

<input type="hidden" name="ajax" id="ajax" value="0">
<!--
{:W('PageHeader',array('name'=>$folder_name,'search'=>'N'))}
-->
<!--
<div class="operate panel panel-default">
    <div class="panel-body">
        <div class="pull-right">
            <a onclick="add()" class="btn btn-sm btn-primary">新增</a>
            <a onclick="save()" class="btn btn-sm btn-primary">保存</a>
            |
            <a onclick="del()" class="btn btn-sm btn-danger">删除</a>
        </div>
    </div>
</div>
-->
<div class="row">
    <div class="col-xs-12 col-sm-6">

        <div>
            <!--节点树顶部标题与导航-->
            <div class="widget-header">
                <h4>WBS节点树</h4>
                <div class="widget-toolbar">
                    <a href="#" class="">
                        <i class="fa fa-plus-square purple"></i>
                        导入节点
                    </a>
                </div>

            </div>
            <div class="widget-body">
                <div class="widget-main">
                    <div class="row">
                        <!--节点树容器-->
                        <div class="col-xs-12 col-sm-6">
                            <present name="node_json">
                                <ul id="wbs_tree" class="ztree"></ul>
                            </present>
                        </div>

                        <!--节点树操作区-->
                        <div class="col-xs-12 col-sm-6">
                            <div class="operate panel panel-default">
                                <div class="panel-body">
                                    <button class="btn btn-primary btn-sm">
                                        <i class="fa fa-edit bigger-110"></i>
                                        新增
                                    </button>
                                    <button class="btn btn-primary btn-sm">
                                        <i class="fa fa-cogs bigger-100"></i>
                                        编辑
                                    </button>
                                </div>
                            </div>

                            <!--临时测试-->
                            <ul class="list-unstyled">
                                <li style="list-style: none;">
                                    <i class="fa fa-check purple" aria-hidden="true"></i>
                                    计划已分配
                                </li>

                                <li>
                                    <i class="fa fa-check green"></i>
                                    进度管理对象已初始化
                                </li>

                                <li>
                                    <i class="fa fa-close red"></i>
                                    财务统计未就绪
                                </li>
                            </ul>

                            <!--bootstrap日期控件测试-->
                            <div class="row">
                                <div class="col-xs-12 col-sm-6">
                                    <div class="input-group">
                                        <input class="form-control date-picker" id="id-date-picker-1" type="text" data-date-format="yyyy-mm-dd" />
                                            <span class="input-group-addon">
                                                <i class="fa fa-calendar"></i>
                                            </span>
                                    </div>
                                </div>
                            </div>

                        </div>
                    </div>
                </div>
            </div>
        </div>

    </div>

    <!--WBS编辑区-->
    <div class="col-xs-12 col-sm-6">

        <!-- 新增WBS模块的容器 -->
        <form id="form_data" name="form_data" method="post" post_url="{:U('wbs/add')}" class="form-horizontal clearfix">
            <div class="tabbable" id="wbs_add_node">
                <!--- 顶部标签页-->
                <ul class="nav nav-tabs" id="wbs_add_node_tab">
                    <li class="active">
                        <a data-toggle="tab" href="#new_wbs_basic">
                            <i class="green fa fa-home bigger-100"></i>
                            基本信息
                        </a>
                    </li>

                    <li class="">
                        <a data-toggle="tab" href="#new_wbs_agent">
                            <i class="blue fa fa-server bigger-50"></i>
                            任务明细
                            <!--  消息条数用法示例
                            <span class="badge badge-danger">4</span>
                            -->
                        </a>
                    </li>

                    <li class="">
                        <a data-toggle="tab" href="#new_wbs_progress">
                            <i class="red fa fa-calendar bigger-50"></i>
                            进度管理
                            <!--  消息条数用法示例
                            <span class="badge badge-danger">4</span>
                            -->
                        </a>
                    </li>

                    <!-- 下拉列表型tab用法示例
                    <li class="dropdown">
                        <a data-toggle="dropdown" class="dropdown-toggle" href="#">
                            Dropdown &nbsp;
                            <i class="icon-caret-down bigger-110 width-auto"></i>
                        </a>

                        <ul class="dropdown-menu dropdown-info">
                            <li>
                                <a data-toggle="tab" href="#dropdown1">@fat</a>
                            </li>

                            <li>
                                <a data-toggle="tab" href="#dropdown2">@mdo</a>
                            </li>
                        </ul>
                    </li>
                    -->
                </ul>

                <!--新增模块表单内容, 分三块-->
                <div class="tab-content">

                    <!--新增WBS基本信息-->
                    <div id="new_wbs_basic" class="tab-pane active">

                        <input type="hidden" name="project_id" id="project_id" value="{$Think.session.proj_id}">
                        <input type="hidden" name="pbs_id" id="pbs_id" value="">
                        <input type="hidden" name="parent_id" id="parent_id" value="">

                        <div class="form-group">
                            <label class="col-sm-2 control-label" for="name">名称* </label>
                            <div class="col-sm-9">
                                <input class="form-control" type="text" id="name" name="name" check="require" msg="请输入WBS名称">
                            </div>
                        </div>

                        <div class="form-group">
                            <label class="col-sm-2 control-label" for="type">WBS类型* </label>
                            <div class="col-sm-9">
                                <div class="input-group">
                                    <select id="type" name="type" form="form_data">
                                        <volist name="type_list" id="vo">
                                            <option value="{$vo.id}">{$vo.name}</option>
                                        </volist>
                                    </select>
                                </div>
                            </div>
                        </div>

                        <div class="form-group">
                            <label class="col-sm-2 control-label" for="engineering_phase">工程阶段* </label>
                            <div class="col-sm-9">
                                <div class="input-group">
                                    <select id="engineering_phase" name="engineering_phase" form="form_data">
                                        <volist name="engineering_phase" id="vo">
                                            <option value="{$vo.id}">{$vo.name}</option>
                                        </volist>
                                    </select>
                                </div>
                            </div>
                        </div>

                        <div class="form-group">
                            <label class="col-sm-2 control-label" for="remark" >备注*</label>
                            <div class="col-sm-10" >
                                <textarea class="form-control" name="remark" id="remark" rows="5" class="col-xs-12" ></textarea>
                            </div>
                        </div>

                        <!--文件上传测试-->
                        <!--<div id="dropzone">
                            <div class="fallback">
                                <input name="file" type="file" multiple="" />
                            </div>
                        </div>-->
                    </div>

                    <!--新增WBS明细(agent)编辑-->
                    <div id="new_wbs_agent" class="tab-pane">
                        WBS明细编辑
                    </div>

                    <div id="new_wbs_progress" class="tab-pane">
                        WBS进度管理单元
                    </div>

                </div>

                <!--新增WBS提交操作区-->
                <div class="clearfix form-actions">
                    <div class="pull-right">
                        <!--<a onclick="add()" class="btn btn-sm btn-primary">新增</a>-->
                        <a onclick="add()" class="btn btn-sm btn-primary">添加</a>
                        |
                        <a onclick="clear()" class="btn btn-sm btn-danger">清空</a>
                    </div>
                </div>


            </div>


        </form>


    </div>
</div>


<include file="Layout:aeropms_footer" />

<!-- inline scripts related to this page -->

<script>
    $('.date-picker').datepicker({
        autoclose: true,
        todayHighlight: true
    }).next().click(function(){
        $(this).prev().focus();
    });

    /*文件上传组件*/
    jQuery(function($){

        try {
            $(".dropzone").dropzone({
                paramName: "file", // The name that will be used to transfer the file
                maxFilesize: 50, // MB

                addRemoveLinks : true,
                dictDefaultMessage :
                        '<span class="bigger-150 bolder"><i class="icon-caret-right red"></i> Drop files</span> to upload \
                        <span class="smaller-80 grey">(or click)</span> <br /> \
                        <i class="icon-cloud-upload blue icon-3x"></i>'
                ,
                dictResponseError: 'Error while uploading file!',

                //change the previewTemplate to use Bootstrap progress bars
                previewTemplate: "<div class=\"dz-preview dz-file-preview\">\n  <div class=\"dz-details\">\n    <div class=\"dz-filename\"><span data-dz-name></span></div>\n    <div class=\"dz-size\" data-dz-size></div>\n    <img data-dz-thumbnail />\n  </div>\n  <div class=\"progress progress-small progress-striped active\"><div class=\"progress-bar progress-bar-success\" data-dz-uploadprogress></div></div>\n  <div class=\"dz-success-mark\"><span></span></div>\n  <div class=\"dz-error-mark\"><span></span></div>\n  <div class=\"dz-error-message\"><span data-dz-errormessage></span></div>\n</div>"
            });
        } catch(e) {
            alert('您的浏览器版本过低, 无法支持Dropzone.js组件.');
        }

    });

</script>