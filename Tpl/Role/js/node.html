<script type="text/javascript">
	function save() {
		$("#node_list").val('');
		$(".wrap .tree_menu input[name='node_id']:checked").each(function() {
			$("#node_list").val($("#node_list").val() + $(this).val() + ",");
		})
		sendForm("form_data", "{:U('set_node')}");
	};

	function showdata(result) {
		$(".wrap .tree_menu input").each(function() {
			$(this).prop("checked", "true");
			$(this).parents("td").removeClass("active");
		});
		for (var s in result.data) {
			$(".wrap .tree_menu input[name='node_id'][value=" + result.data[s].node_id + "]").prop("checked", "true");

			if (result.data[s].admin == 1) {
				$(".wrap .tree_menu input[name='admin[]'][value=" + result.data[s].node_id + "]").prop("checked", "true");
				$(".wrap .tree_menu input[name='admin[]'][value=" + result.data[s].node_id + "]").parents("td").addClass("active");
			}
			if (result.data[s].write == 1) {
				$(".wrap .tree_menu input[name='write[]'][value=" + result.data[s].node_id + "]").prop("checked", "true");
				$(".wrap .tree_menu input[name='write[]'][value=" + result.data[s].node_id + "]").parents("td").addClass("active");
			}
			if (result.data[s].read == 1) {
				$(".wrap .tree_menu input[name='read[]'][value=" + result.data[s].node_id + "]").prop("checked", "true");
				$(".wrap .tree_menu input[name='read[]'][value=" + result.data[s].node_id + "]").parents("td").addClass("active");
			}
			$(".wrap .tree_menu input[node=" + result.data[s].node_id + "]").parents("td").addClass("active");
		};
		$("#org_node_list").val('');
		$(".wrap .tree_menu input[name='node_id']:checked").each(function() {;
			$("#org_node_list").val($("#org_node_list").val() + $(this).val() + ",");
		})
		$("#opmode").val("edit");
	};

	$(document).ready(function() {
		set_return_url();
		$(".role_list tbody tr").click(function() {
			$(".role_list  tr").removeClass("active");
			$(this).attr("class", "active");
			$("#role_id").val($(this).attr("id"));
			sendAjax("{:U('get_node_list')}", "role_id=" + $(this).attr("id"), function(data) {
				showdata(data);
			});
			return false;
		})

		$(".wrap .tree_menu input").on('click', function(event) {
			if ($(this).prop("checked") == true) {
				$(this).find("input").prop('checked', false);		
			}else{
				$(this).find("input").prop('checked', true);
			}
			$(this).parents("label").click();
		})
		
		$(".wrap .tree_menu label").on('click', function(event) {			
			if ($(this).find("input").prop("checked") == true) {
				$(this).find("input").prop('checked', false);				
				$(this).parents("td").removeClass("active");
				//alert($(this).parents("td").html());
				
			} else {
				if ($(this).find("input").length > 0) {
				
					$(this).find("input").prop('checked', true);			
					$(this).parents("td").removeClass("active");						
				}
			}
			event.stopPropagation();
		})
		
		

		$(".wrap.tree_menu  td").click(function() {
			if ($(this).find("input").prop("checked") == true) {
				$(this).find("input").prop('checked', false);
				$(this).removeClass("active");
			} else {
				if ($(this).find("input").length > 0) {
					$(this).find("input").prop('checked', true);
					$(this).addClass("active");
				}
			}
		})
	}); 
</script>